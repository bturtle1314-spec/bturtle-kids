<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B TURTLE Kidsï½œæ¯æ—¥ä»»å‹™å„€è¡¨æ¿</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",Arial; max-width:760px; margin:24px auto; padding:0 16px; line-height:1.6;}
    .card{border:1px solid #e5e7eb; border-radius:12px; padding:16px; margin:12px 0;}
    button{padding:10px 14px; border-radius:10px; border:1px solid #111827; background:#111827; color:#fff; cursor:pointer; margin-right:8px;}
    button.secondary{background:#fff; color:#111827;}
    .muted{color:#6b7280; font-size:14px;}
    img{max-width:100%; border-radius:12px; border:1px solid #e5e7eb;}
    .row{display:flex; gap:10px; flex-wrap:wrap;}
  </style>
</head>
<body>
  <h1>ğŸ¢ B TURTLE Kidsï½œæ¯æ—¥ä»»å‹™å„€è¡¨æ¿</h1>
  <p class="muted" id="status">è¼‰å…¥ä¸­â€¦</p>

  <div class="card">
    <div class="muted" id="todayLine"></div>
    <h2 id="dayTitle">Day ?</h2>
  </div>

  <div class="card">
    <h3>ä»Šæ—¥äºŒé¸ä¸€</h3>
    <div class="row">
      <button onclick="pick('A')">é¸ A</button>
      <button class="secondary" onclick="pick('B')">é¸ B</button>
    </div>
    <h4 id="pickedTitle" style="margin-top:12px;">ï¼ˆè«‹å…ˆé¸ A æˆ– Bï¼‰</h4>
    <p id="pickedBody"></p>
  </div>

  <div class="card">
    <h3>å®Œæˆå¾Œè§£é–çå‹µ</h3>
    <button onclick="unlock()">æˆ‘å®Œæˆäº†ï¼Œè§£é–ï¼</button>
    <div id="rewardBox" style="display:none; margin-top:12px;">
      <h4 id="rewardTitle"></h4>
      <img id="rewardImg" alt="reward" />
    </div>
  </div>

<script>
  let DATA = null;
  let TODAY = null;

  function ymd(d){
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }

  function diffDays(a, b){
    // a,b: Date
    const ms = 24*60*60*1000;
    const ua = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
    const ub = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());
    return Math.floor((ua-ub)/ms);
  }

  function currentDayObj(){
    const start = new Date(DATA.startDate + "T00:00:00");
    const idx = diffDays(TODAY, start); // 0-based
    const dayNumber = Math.max(1, Math.min(DATA.days.length, idx + 1));
    const obj = DATA.days.find(x => x.day === dayNumber) || DATA.days[dayNumber-1];
    return { dayNumber, obj };
  }

  function renderHeader(){
    TODAY = new Date();
    document.getElementById('todayLine').textContent = `ä»Šå¤©ï¼š${ymd(TODAY)}ï½œè³‡æ–™èµ·å§‹æ—¥ï¼š${DATA.startDate}`;
    const { dayNumber } = currentDayObj();
    document.getElementById('dayTitle').textContent = `Day ${dayNumber}`;
  }

  function pick(which){
    const { obj } = currentDayObj();
    const choice = which === 'A' ? obj.choiceA : obj.choiceB;
    document.getElementById('pickedTitle').textContent = choice.title;
    document.getElementById('pickedBody').textContent = choice.body;
  }

  function unlock(){
    const { obj } = currentDayObj();
    document.getElementById('rewardTitle').textContent = obj.reward.title;
    document.getElementById('rewardImg').src = obj.reward.img;
    document.getElementById('rewardBox').style.display = 'block';
  }

  async function boot(){
    try{
      const res = await fetch('./data.json', { cache: 'no-store' });
      if(!res.ok) throw new Error('è®€å– data.json å¤±æ•—ï¼š' + res.status);
      DATA = await res.json();
      renderHeader();
      document.getElementById('status').textContent = 'âœ… è¼‰å…¥æˆåŠŸ';
    }catch(e){
      document.getElementById('status').textContent = 'âŒ ' + e.message;
      console.error(e);
    }
  }

  boot();
</script>
</body>
</html>
